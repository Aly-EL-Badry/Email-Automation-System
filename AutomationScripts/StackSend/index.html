<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bulk Personalized Email Sender</title>
    <!-- Tailwind CSS CDN for modern, responsive styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for enhanced UX */
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .shake {
            animation: shake 0.5s;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        /* Custom scrollbar for textarea */
        textarea::-webkit-scrollbar {
            width: 8px;
        }
        
        textarea::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        textarea::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        
        textarea::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen py-8 px-4">
    <div class="max-w-2xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-8 fade-in">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-800 mb-2">
                Bulk Personalized Email Sender
            </h1>
            <p class="text-gray-600 text-sm md:text-base">
                Send personalized emails to multiple recipients from your Gmail account
            </p>
        </div>

        <!-- Main Card -->
        <div class="bg-white rounded-xl shadow-lg p-6 md:p-8 fade-in">
            <!-- Gmail Connect Section -->
            <div class="mb-8 pb-8 border-b border-gray-200">
                <label class="block text-sm font-semibold text-gray-700 mb-3">
                    Gmail Account
                </label>
                <button 
                    id="connectGmailBtn"
                    class="w-full md:w-auto px-6 py-3 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg transition-colors duration-200 shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2"
                >
                    <span id="gmailBtnText">ðŸ”— Connect Gmail</span>
                </button>
                <p class="text-xs text-gray-500 mt-2">
                    <!-- TODO: Replace this placeholder with actual OAuth flow -->
                    Note: OAuth integration should be handled externally. This button is for UI purposes only.
                </p>
            </div>

            <!-- Email Subject Input -->
            <div class="mb-6">
                <label for="emailSubject" class="block text-sm font-semibold text-gray-700 mb-2">
                    Email Subject <span class="text-red-500">*</span>
                </label>
                <input 
                    type="text" 
                    id="emailSubject" 
                    placeholder="e.g., Invitation to {{event}} on {{date}}"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                />
                <p class="text-xs text-gray-500 mt-1">
                    Use placeholders like {{name}}, {{event}}, {{date}} for personalization
                </p>
            </div>

            <!-- Email Template Textarea -->
            <div class="mb-6">
                <label for="emailTemplate" class="block text-sm font-semibold text-gray-700 mb-2">
                    Email Template <span class="text-red-500">*</span>
                </label>
                <textarea 
                    id="emailTemplate" 
                    rows="8"
                    placeholder="Hi {{name}},&#10;&#10;You're invited to {{event}} on {{date}}.&#10;&#10;Looking forward to seeing you there!&#10;&#10;Best regards"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-y transition-all"
                ></textarea>
                <p class="text-xs text-gray-500 mt-1">
                    Use double curly braces for placeholders: {{name}}, {{event}}, {{date}}, etc.
                </p>
            </div>

            <!-- Excel/Google Sheets URL Input -->
            <div class="mb-8">
                <label for="excelUrl" class="block text-sm font-semibold text-gray-700 mb-2">
                    Excel / Google Sheets URL <span class="text-red-500">*</span>
                </label>
                <input 
                    type="url" 
                    id="excelUrl" 
                    placeholder="https://docs.google.com/spreadsheets/d/... or https://example.com/data.xlsx"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                />
                <p class="text-xs text-gray-500 mt-1">
                    Paste the full URL to your Excel file or Google Sheets (make sure it's publicly accessible or shared)
                </p>
            </div>

            <!-- Webhook URL Input (for configuration) -->
            <div class="mb-8 pb-8 border-b border-gray-200">
                <label for="webhookUrl" class="block text-sm font-semibold text-gray-700 mb-2">
                    Webhook URL <span class="text-red-500">*</span>
                </label>
                <input 
                    type="url" 
                    id="webhookUrl" 
                    placeholder="https://YOUR_N8N_DOMAIN/webhook/send-emails"
                    value="https://YOUR_N8N_DOMAIN/webhook/send-emails"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all bg-gray-50"
                />
                <p class="text-xs text-gray-500 mt-1">
                    <!-- TODO: Replace with your actual n8n webhook URL -->
                    Configure this with your actual n8n webhook endpoint
                </p>
            </div>

            <!-- Send Emails Button -->
            <button 
                id="sendEmailsBtn"
                class="w-full px-6 py-4 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition-colors duration-200 shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"
            >
                <span id="sendBtnText">ðŸ“§ Send Emails</span>
            </button>

            <!-- Status Messages -->
            <div id="statusMessage" class="mt-6 hidden"></div>
        </div>

        <!-- Footer Info -->
        <div class="text-center mt-6 text-sm text-gray-600">
            <p>All fields marked with <span class="text-red-500">*</span> are required</p>
        </div>
    </div>

    <script>
        // DOM Elements
        const connectGmailBtn = document.getElementById('connectGmailBtn');
        const gmailBtnText = document.getElementById('gmailBtnText');
        const emailSubject = document.getElementById('emailSubject');
        const emailTemplate = document.getElementById('emailTemplate');
        const excelUrl = document.getElementById('excelUrl');
        const webhookUrl = document.getElementById('webhookUrl');
        const sendEmailsBtn = document.getElementById('sendEmailsBtn');
        const sendBtnText = document.getElementById('sendBtnText');
        const statusMessage = document.getElementById('statusMessage');

        // Gmail Connect Button Handler (Placeholder)
        connectGmailBtn.addEventListener('click', () => {
            // TODO: Implement actual OAuth flow here
            // This is a placeholder - replace with your OAuth implementation
            const isConnected = connectGmailBtn.dataset.connected === 'true';
            
            if (!isConnected) {
                // Simulate connection (replace with actual OAuth)
                connectGmailBtn.dataset.connected = 'true';
                gmailBtnText.textContent = 'âœ… Gmail Connected';
                connectGmailBtn.classList.remove('bg-red-600', 'hover:bg-red-700');
                connectGmailBtn.classList.add('bg-green-600', 'hover:bg-green-700');
                showStatus('Gmail account connected successfully!', 'success');
            } else {
                // Simulate disconnection
                connectGmailBtn.dataset.connected = 'false';
                gmailBtnText.textContent = 'ðŸ”— Connect Gmail';
                connectGmailBtn.classList.remove('bg-green-600', 'hover:bg-green-700');
                connectGmailBtn.classList.add('bg-red-600', 'hover:bg-red-700');
                showStatus('Gmail account disconnected.', 'info');
            }
        });

        // Input Validation
        function validateInputs() {
            const errors = [];
            
            if (!emailSubject.value.trim()) {
                errors.push('Email subject is required');
                emailSubject.classList.add('border-red-500');
            } else {
                emailSubject.classList.remove('border-red-500');
            }
            
            if (!emailTemplate.value.trim()) {
                errors.push('Email template is required');
                emailTemplate.classList.add('border-red-500');
            } else {
                emailTemplate.classList.remove('border-red-500');
            }
            
            if (!excelUrl.value.trim()) {
                errors.push('Excel/Google Sheets URL is required');
                excelUrl.classList.add('border-red-500');
            } else if (!isValidUrl(excelUrl.value.trim())) {
                errors.push('Please enter a valid URL');
                excelUrl.classList.add('border-red-500');
            } else {
                excelUrl.classList.remove('border-red-500');
            }
            
            if (!webhookUrl.value.trim()) {
                errors.push('Webhook URL is required');
                webhookUrl.classList.add('border-red-500');
            } else if (!isValidUrl(webhookUrl.value.trim())) {
                errors.push('Please enter a valid webhook URL');
                webhookUrl.classList.add('border-red-500');
            } else {
                webhookUrl.classList.remove('border-red-500');
            }
            
            // Check if Gmail is connected (optional validation)
            if (connectGmailBtn.dataset.connected !== 'true') {
                // Uncomment the line below if Gmail connection is required
                // errors.push('Please connect your Gmail account first');
            }
            
            return errors;
        }

        // URL Validation Helper
        function isValidUrl(string) {
            try {
                const url = new URL(string);
                return url.protocol === 'http:' || url.protocol === 'https:';
            } catch (_) {
                return false;
            }
        }

        // Show Status Message
        function showStatus(message, type = 'info') {
            statusMessage.classList.remove('hidden', 'bg-red-50', 'bg-green-50', 'bg-blue-50', 'border-red-200', 'border-green-200', 'border-blue-200', 'text-red-800', 'text-green-800', 'text-blue-800');
            
            let bgColor, borderColor, textColor;
            switch(type) {
                case 'success':
                    bgColor = 'bg-green-50';
                    borderColor = 'border-green-200';
                    textColor = 'text-green-800';
                    break;
                case 'error':
                    bgColor = 'bg-red-50';
                    borderColor = 'border-red-200';
                    textColor = 'text-red-800';
                    break;
                default:
                    bgColor = 'bg-blue-50';
                    borderColor = 'border-blue-200';
                    textColor = 'text-blue-800';
            }
            
            statusMessage.className = `mt-6 p-4 rounded-lg border ${bgColor} ${borderColor} ${textColor} fade-in`;
            statusMessage.textContent = message;
            statusMessage.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Remove error styling on input
        [emailSubject, emailTemplate, excelUrl, webhookUrl].forEach(input => {
            input.addEventListener('input', () => {
                input.classList.remove('border-red-500');
            });
        });

        // Send Emails Handler
        sendEmailsBtn.addEventListener('click', async () => {
            // Validate inputs
            const errors = validateInputs();
            if (errors.length > 0) {
                showStatus('Please fix the following errors: ' + errors.join(', '), 'error');
                document.querySelector('.shake')?.classList.remove('shake');
                setTimeout(() => {
                    sendEmailsBtn.classList.add('shake');
                }, 10);
                return;
            }

            // Disable button and show loading state
            sendEmailsBtn.disabled = true;
            sendBtnText.textContent = 'â³ Sending...';
            
            // Prepare payload
            const payload = {
                subject: emailSubject.value.trim(),
                template: emailTemplate.value.trim(),
                excel_url: excelUrl.value.trim()
            };

            try {
                // TODO: Replace webhookUrl.value with your actual n8n webhook URL
                const response = await fetch(webhookUrl.value.trim(), {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json().catch(() => ({}));
                
                // Success
                showStatus('âœ… Emails sent successfully! Check your webhook logs for details.', 'success');
                
                // Optional: Reset form after success (uncomment if desired)
                // emailSubject.value = '';
                // emailTemplate.value = '';
                // excelUrl.value = '';
                
            } catch (error) {
                console.error('Error sending emails:', error);
                showStatus(`âŒ Error sending emails: ${error.message}. Please check your webhook URL and try again.`, 'error');
            } finally {
                // Re-enable button
                sendEmailsBtn.disabled = false;
                sendBtnText.textContent = 'ðŸ“§ Send Emails';
            }
        });

        // Allow Enter key to submit (but not in textarea)
        emailSubject.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                sendEmailsBtn.click();
            }
        });

        excelUrl.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                sendEmailsBtn.click();
            }
        });
    </script>
</body>
</html>

